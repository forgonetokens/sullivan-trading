<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/admin-head') %>
  <title><%= post && post.id ? 'Edit' : 'New' %> Post â€” Sullivan Trading Admin</title>
</head>
<body>
  <%- include('../partials/admin-nav') %>
  <div class="admin-wrap">
    <h1 class="page-title"><%= post && post.id ? 'Edit' : 'New' %> Post</h1>

    <% if (error) { %>
      <div style="background: rgba(231,76,60,0.15); border: 1px solid rgba(231,76,60,0.3); color: #e74c3c; padding: .75rem 1rem; margin-bottom: 1.25rem; font-size: .85rem;"><%= error %></div>
    <% } %>

    <form method="POST" action="<%= post && post.id ? '/admin/posts/' + post.id : '/admin/posts' %>" class="card" style="max-width: 800px;">
      <div class="form-group">
        <label>Title</label>
        <input type="text" name="title" value="<%= post ? post.title || '' : '' %>" required
          oninput="if(!document.getElementById('slug-edited').value) document.getElementById('slug').value = this.value.toLowerCase().trim().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'')">
      </div>

      <div class="form-group">
        <label>Slug</label>
        <input type="text" name="slug" id="slug" value="<%= post ? post.slug || '' : '' %>"
          oninput="document.getElementById('slug-edited').value='1'">
        <input type="hidden" id="slug-edited" value="<%= post && post.slug ? '1' : '' %>">
        <span style="font-size: .7rem; color: var(--fog);">Auto-generated from title. Edit to customize.</span>
      </div>

      <div class="form-group">
        <label>Excerpt</label>
        <textarea name="excerpt" rows="2" placeholder="Brief summary for post listings..."><%= post ? post.excerpt || '' : '' %></textarea>
      </div>

      <div class="form-group">
        <label>Body (Markdown)</label>
        <textarea name="body" rows="18" style="font-family: 'Source Code Pro', monospace; font-size: .85rem; min-height: 300px;"><%= post ? post.body || '' : '' %></textarea>
      </div>

      <div class="form-group">
        <label>Hero Image</label>
        <input type="text" name="hero_image" value="<%= post ? post.hero_image || '' : '' %>" placeholder="e.g. hero-double-seam-can.jpg">
        <span style="font-size: .7rem; color: var(--fog);">Filename in /images/blog/. Used for OG/social sharing image.</span>
      </div>

      <div class="form-group">
        <label>Status</label>
        <select name="status">
          <option value="draft" <%= post && post.status === 'draft' ? 'selected' : '' %>>Draft</option>
          <option value="published" <%= post && post.status === 'published' ? 'selected' : '' %>>Published</option>
        </select>
      </div>

      <div style="display: flex; gap: 1rem; margin-top: 1rem;">
        <button type="submit" class="btn btn-gold"><%= post && post.id ? 'Update' : 'Create' %> Post</button>
        <a href="/admin/posts" class="btn btn-outline">Cancel</a>
      </div>
    </form>
  </div>
</body>
</html>
